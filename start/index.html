<!DOCTYPE html>
<title>Dungee</title>
<meta charset="UTF-8"/>
<nav>
    <a href="/">Home</a>
    <a href="start">Start new Dungee</a>
    <a href="play">Play existing Dungee</a>
</nav>

<div id="lodearriba">
    <h1>Create new Dungee</h1>
    <button onclick="generarandom()">CREATE DUNGEE</button>
    <p id="pinEl"></p>
    <p id="playersEl"></p>
    <button onclick="mostrarPreguntas()">JUGAR YA!</button>
</div>

<p id="preguntasEl"></p>

<script>
    let pin;
    let obtenerUsuariosInterval;

    function generarandom(){
        pin = Math.floor(Math.random()*9000)+1000;
        pinEl.innerText = pin;
        playersEl.innerText = "";

        obtenerUsuariosInterval = setInterval(obtenerUsuarios, 3000);
    }

    function obtenerUsuarios(){
        fetch(`/api/damelosusers?pin=${pin}`)
        .then(string => string.json())
        .then(json => {
            playersEl.innerText  = "";

            for (const x in json.users) {
                playersEl.innerText += json.users[x].name;
            }
        })
    }

    function mostrarPreguntas() {

        clearInterval(obtenerUsuariosInterval);

        fetch("/api/damelasquestions")
        .then(data =>  data.json())
        .then(questions => {
            let html = "";
            for (const pregunta in questions.preguntas){
                html += "<h1>" + questions.preguntas[pregunta].pregunta + "</h1>";
                html += "<ul>"
                html += "<li>" + questions.preguntas[pregunta].respuesta0;
                html += "<li>" + questions.preguntas[pregunta].respuesta1;
                html += "<li>" + questions.preguntas[pregunta].respuesta2;
                html += "<li>" + questions.preguntas[pregunta].respuesta3;
                html += "</ul>"
            }
            preguntasEl.innerHTML = html;
        });

        ocultarCosasDeArriba();

    }

    function ocultarCosasDeArriba(){
        lodearriba.classList.toggle("oculto");
    }

</script>



<style> 
.oculto {
    display: none;
}
</style>