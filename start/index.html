<!DOCTYPE html>
<meta charset="UTF-8"/>

<title>Dungee</title>

<nav>
    <a href="/">Home</a>
    <a href="start">Start a new Dungee</a>
    <a href="play">Play an existing Dungee</a>    
</nav>

<div id="createFragment" class="fragment">
    <h1><svg width="51.178mm" height="23.928mm" version="1.1" viewBox="0 0 51.178 23.928" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-6.6282 -78.76)">        <g transform="matrix(1.9688 0 0 2.6878 -52.523 -137.31)" style="stroke-width:.26458;white-space:pre" aria-label="START">              <path d="m36.518 86.585c0 0.39511-0.07761 0.75494-0.23283 1.0795-0.14817 0.3175-0.35278 0.59266-0.61383 0.8255-0.254 0.23283-0.55739 0.41275-0.91016 0.53975-0.34572 0.127-0.71966 0.1905-1.1218 0.1905-0.28222 0 0 0-0.98442 0.03064 0 0-2.3502 0.16791-2.6112-0.1637l2.7172-2.354c0.04939 0.09172 0.12347 0.18697 0.22225 0.28575 0.09878 0.09172 0.20814 0.17286 0.32808 0.24342 0.127 0.07055 0.25047 0.13053 0.37042 0.17992 0.127 0.04233 0.23989 0.0635 0.33866 0.0635 0.08467 0 0.17286-0.01411 0.26458-0.04233 0.09172-0.02822 0.17639-0.07055 0.254-0.127 0.07761-0.05645 0.13758-0.11995 0.17992-0.1905 0.04939-0.07761 0.07408-0.1658 0.07408-0.26458 0-0.16933-0.05644-0.32455-0.16933-0.46566-0.10583-0.14817-0.23989-0.28575-0.40216-0.41275-0.16228-0.13406-0.33867-0.26811-0.52916-0.40217s-0.36689-0.27516-0.52916-0.42333c-0.15522-0.14817-0.28928-0.31397-0.40217-0.49742-0.11289-0.18344-0.16933-0.38805-0.16933-0.61383 0-0.36689 0.10936-0.70908 0.32808-1.0266s0.49036-0.58914 0.81491-0.81491c0.33161-0.23283 0.69144-0.41628 1.0795-0.55033 0.38805-0.13406 0.75494-0.20108 1.1007-0.20108 0.1905 0 0.37042 0.02469 0.53975 0.07408 0.16933 0.04233 0.31397 0.11642 0.43392 0.22225 0.127 0.09878 0.22578 0.22578 0.29633 0.381 0.07761 0.15522 0.11642 0.34925 0.11642 0.58208 0 0.09878-0.01058 0.19756-0.03175 0.29633-0.01411 0.09878-0.02822 0.20461-0.04233 0.3175l-1.5346 0.4445c0.01411-0.05645 0.0247-0.11289 0.03175-0.16933 0.01411-0.05645 0.02117-0.11289 0.02117-0.16933 0-0.21167-0.03881-0.36336-0.11642-0.45508-0.07055-0.09878-0.1658-0.14817-0.28575-0.14817-0.05645 0-0.127 0.02117-0.21167 0.0635-0.07761 0.04233-0.15875 0.09878-0.24342 0.16933-0.07761 0.0635-0.14464 0.14111-0.20108 0.23283-0.05645 0.09172-0.08467 0.1905-0.08467 0.29633 0 0.16933 0.04586 0.31044 0.13758 0.42333 0.09878 0.11289 0.21872 0.21872 0.35983 0.3175 0.14111 0.09878 0.2928 0.20108 0.45508 0.30692 0.16933 0.09878 0.32455 0.2293 0.46566 0.39158s0.25753 0.36689 0.34925 0.61383c0.09878 0.23989 0.14817 0.5468 0.14817 0.92075z" style="-inkscape-stroke:none;color:#000000"/>              <path d="m37.333 89.209q0.24342-1.1642 0.46566-2.2966 0.09525-0.47625 0.1905-0.99483 0.09525-0.51858 0.17992-1.016 0.09525-0.508 0.15875-0.97366 0.07408-0.47625 0.127-0.86783-0.24342-0.03175-0.49742-0.02117-0.24342 0.01058-0.48683-0.0635 0.01058-0.16933 0.01058-0.39158t0.01058-0.4445q0.01058-0.24342 0.02117-0.51858 0.27517 0.02117 0.55033 0.03175 0.27516 0.01058 0.55033 0.01058 0.53975 0 1.0372-0.02117 0.508-0.03175 0.93133-0.0635 0.43392-0.04233 0.84666-0.09525l-0.11642 0.5715q-0.05292 0.24342-0.10583 0.49742-0.04233 0.254-0.08467 0.43392-0.23283 0.0635-0.47625 0.09525-0.23283 0.02117-0.46567 0.0635-0.07408 0.35983-0.15875 0.80433-0.08467 0.43392-0.16933 0.91016-0.07408 0.46566-0.14817 0.9525-0.07408 0.48683-0.14817 0.93133-0.16933 1.0477-0.3175 2.1696z" style="-inkscape-stroke:none;color:#000000"/>  <path d="m43.884 88.987q-0.26458 0.04233-0.58208 0.09525t-0.5715 0.09525q0.04233-0.34925 0.08467-0.68791 0.03175-0.29633 0.05292-0.59266 0.03175-0.29633 0.05292-0.508h-0.92075l-0.42333 1.524q-0.23283 0.03175-0.55033 0.07408-0.3175 0.03175-0.59266 0.0635-0.33867 0.04233-0.66675 0.08467 0.42333-1.4076 0.83608-2.7728 0.16933-0.5715 0.34925-1.1959 0.1905-0.62442 0.37042-1.2382 0.1905-0.62442 0.35983-1.1959 0.16933-0.5715 0.29633-1.0477 0.71966-0.05292 1.4605-0.127 0.75141-0.07408 1.4605-0.20108-0.03175 0.33867-0.07408 0.84666-0.03175 0.49742-0.0635 1.0901t-0.0635 1.2382-0.0635 1.27q-0.05292 1.4605-0.11642 3.1009-0.3175 0.05292-0.635 0.08467zm-1.6298-2.6564q0.04233 0 0.14817 0 0.11642-0.01058 0.23283-0.01058 0.127-0.01058 0.23283-0.01058 0.10583-0.01058 0.14817-0.02117 0-0.0635 0.01058-0.21167 0.02117-0.15875 0.03175-0.34925 0.02117-0.20108 0.04233-0.43392 0.02117-0.23283 0.04233-0.45508 0.04233-0.53975 0.10583-1.1642l0.0635-0.92075-0.15875 0.01058-0.24342 0.91016z" style="-inkscape-stroke:none;color:#000000"/>              <path d="m44.615 89.209q0.28575-1.4076 0.55033-2.7517 0.09525-0.5715 0.21167-1.1853 0.11642-0.62442 0.21167-1.2277 0.10583-0.61383 0.1905-1.1747 0.09525-0.5715 0.14817-1.0372 0.60325-0.1905 1.3017-0.27517 0.6985-0.09525 1.3864-0.09525 0.41275 0 0.67733 0.09525 0.27517 0.09525 0.42333 0.27517 0.15875 0.16933 0.22225 0.40216t0.0635 0.51858q0 0.42333-0.14817 0.83608-0.14817 0.40217-0.40217 0.77258-0.24342 0.35983-0.5715 0.66675-0.3175 0.29633-0.68791 0.48683 0.1905 0.42333 0.40216 0.93133 0.22225 0.49742 0.41275 0.9525 0.21167 0.52916 0.43392 1.0583l-1.6404 0.5715q-0.21167-0.73025-0.381-1.3758-0.07408-0.26458-0.14817-0.53975-0.07408-0.28575-0.13758-0.52916-0.0635-0.254-0.10583-0.4445-0.04233-0.1905-0.05292-0.29633l-0.13758 0.04233q-0.0635 0.33867-0.15875 0.8255-0.08467 0.48683-0.15875 0.94191-0.09525 0.53975-0.1905 1.1112zm2.4871-4.5932q0.20108-0.02117 0.48683-0.16933 0.29633-0.14817 0.56091-0.34925 0.26458-0.21167 0.45508-0.43392 0.1905-0.22225 0.1905-0.39158 0-0.11642-0.07408-0.17992-0.07408-0.07408-0.21167-0.10583-0.127-0.04233-0.28575-0.05292-0.15875-0.01058-0.32808-0.01058-0.11642 0-0.24342 0.01058-0.11642 0-0.21167 0z" style="-inkscape-stroke:none;color:#000000"/>              <path d="m50.118 89.209c0.16228-0.77611 0.3175-1.5416 0.46566-2.2966 0.0635-0.3175 0.127-0.64911 0.1905-0.99483s0.12347-0.68439 0.17992-1.016c0.0635-0.33866 0.11642-0.66322 0.15875-0.97366 0.04939-0.3175 0.09172-0.60678 0.127-0.86783-0.16228-0.02117-0.32808-0.02822-0.49742-0.02117-0.16228 0.0071-0.32456-0.01411-0.48683-0.0635 0.0071-0.11289 0.01058-0.24342 0.01058-0.39158s0.0035-0.29633 0.01058-0.4445c0.0071-0.16228 0.01411-0.33514 0.02117-0.51858 0.18344 0.01411 0.36689 0.0247 0.55033 0.03175 0.18344 0.0071 0.36689 0.01058 0.55033 0.01058 0.35983 0 0.70555-0.0071 1.0372-0.02117 0.33866-0.02117 0.07952 0.19049 1.832-0.54165l1.7709-0.71013-1.138 1.4326c-0.03528 0.16228-0.25889 0.41775-0.99382 1.1633 0.73494-0.74554 0.02823-0.11994 0 0-0.15522 0.04233-0.31397 0.07408-0.47625 0.09525-0.15522 0.01411-0.31044 0.03528-0.46566 0.0635-0.04939 0.23989-0.1023 0.508-0.15875 0.80433-0.05645 0.28928-0.11289 0.59266-0.16933 0.91016-0.04939 0.31044-0.09878 0.62794-0.14817 0.9525-0.04939 0.32456-0.09877 0.635-0.14817 0.93133-0.11289 0.6985-0.21872 1.4217-0.3175 2.1696z" style="-inkscape-stroke:none;color:#000000"/></g></g></svg>  </h1>
    <button onclick="generarPIN()">CREAR PIN</button>
</div>

<div id="pinFragment" class="fragment">
    <p id="pinEl"></p>
    <button onclick="startGame()">EMPEZAR</button>
    <ul id="usersEl"></ul>
</div>

<div id="preguntasFragment" class="fragment">
    <div id="preguntasEl"></div>
</div>

<script type="module">
    import {fetchUsuarios, fetchPreguntas, updatePreguntaActual} from '/modules/db.js';
    window.fetchUsuarios = fetchUsuarios;
    window.fetchPreguntas = fetchPreguntas;
    window.updatePreguntaActual = updatePreguntaActual;
    // https://stackoverflow.com/a/53630402
</script>

<script>
let pin;
let obtenerUsuariosInterval;

mostrar("createFragment", "fragment");

function generarPIN(){
    
    mostrar("pinFragment", "fragment");

    pin = Math.floor(Math.random()*9000)+1000;
    pinEl.innerText = pin;

    obtenerUsuariosInterval = setInterval(mostarListaUsuarios, 3000);
}

function mostarListaUsuarios(){
    
    fetchUsuarios().then(json => {
        if (json == null) return;

        let usersList = ""
        for (const x in json.users){
            usersList += `<li>${json.users[x].name}`;
        }
        usersEl.innerHTML = usersList
    });
}

function startGame(){
    mostrar("preguntasFragment", "fragment");

    clearInterval(obtenerUsuariosInterval);

    fetchPreguntas().then(json => {
        let codiHTML = "";
        let i = 0;
        for ( const pregunta in json.preguntas){
            codiHTML += `<div id='pregunta${i}' class='pregunta' class='oculto'>
                <h1>${json.preguntas[pregunta].pregunta} </h1>
                <ul>
                    <li>${json.preguntas[pregunta].respuesta0}</li>
                    <li>${json.preguntas[pregunta].respuesta1}</li>
                    <li>${json.preguntas[pregunta].respuesta2}</li>
                    <li>${json.preguntas[pregunta].respuesta3}</li>
                </ul>
                </div>`
            i++;
        }
        preguntasEl.innerHTML = codiHTML;

        irMostrandoPreguntas(i-1);
    });
}


function irMostrandoPreguntas(cantidad){

    let i = 0;

    mostrar(`pregunta${i}`, "pregunta");
    updatePreguntaActual(i);


    let MostrarPregs = setInterval(()=> {
        i++;
        mostrar(`pregunta${i}`, "pregunta");
        updatePreguntaActual(i);
        
        if(i == cantidad){
            clearInterval(MostrarPregs)
        }

    }, 1500);
        
}


// lib
function mostrar(elementId, className){
    document.querySelectorAll(`.${className}`).forEach(el => el.classList.add("oculto"));
    document.getElementById(elementId).classList.remove("oculto");
}

</script> 





<style>
    .oculto {
        display: none;
    }

    nav {
        display: flex;
        gap: 2em;
        padding: 1.4em;
        background-color: hsl(138, 94%, 14%);
        box-shadow: 2px 2px 12px Xrgb(3, 3, 3);
        transition: background-color 3s;
    }

    nav span.separador {
        width: 1px;
        background: linear-gradient(#ffffff00, rgb(190, 190, 190), #ffffff00);
    }

    nav a {
        color: white;
        text-decoration: none;
        border-radius: 8px;
        padding: 0.8em;
        display: flex;
    }

    nav a:hover {
        background-color: hsl(138, 94%, 34%);
        transition: background-color 0.6s;
    }

    section a {
        color: white;
        text-decoration: none;
        border-radius: 16px;
        padding: 0.8em;
        display: flex;
        background: rgb(71, 40, 207);
    }

    body {
        margin: 2;
        background: linear-gradient(90deg, hsl(138, 94%, 14%),hsl(133, 71%, 69%));
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: large;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    html {
        height: 100%;
    }

    .buttons {
        justify-content: center;
        display: flex;
        gap: 2em;;
    }

    section {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 5em;
        height: 100%;

    }

    footer {
        width: 100%;
        color: white;
        padding: 1em;
        text-align: center;
    }

    ul { 
        color: white;
        padding: 1em;
        background: rgb(176, 163, 237);
    }
    
    .pregunta li {
        padding: 1em;
    }
</style>